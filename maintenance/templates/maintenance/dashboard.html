{% extends 'base.html' %} {% block content %} {% load static %}
<div class="row">
  <div class="col-12">
    <div class="d-flex align-items-center gap-4 mb-4">
      <div class="position-relative">
        <div class="border border-2 border-primary rounded-circle">
          <img
            src="{% static 'assets/images/custom_image/gpt_sat.png' %}"
            class="rounded-circle m-1"
            alt="user1"
            width="60"
          />
        </div>
      </div>
      <div>
        <h3 class="fw-semibold">PT. Solo Abadi Teknik (SAT)</h3>
        <span
          >Perbaikan & Suku Cadang Kendaraan · Jl. Solo - Semarang KM 18, Teras,
          Boyolali, Jawa Tengah, Indonesia 57372</span
        >
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-4">
    <div class="card mx-2">
      <div class="card-body">
        <h5 class="card-title">Total Trucks</h5>
        <h2 class="text-primary">{{ truck_count }}</h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Avg Fuel Efficiency</h5>
        <h2 class="text-success">-</h2>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Maintenance Due</h5>
        <h2 class="text-danger">0</h2>
      </div>
    </div>
  </div>
  <!-- <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Fuel Cost (Monthly)</h5>
        <h2 class="text-warning">Rp 5,400,000,-</h2>
      </div>
    </div>
  </div> -->
</div>

<div class="row mt-2">
  <div class="col-md-12">
    <div class="card mx-2">
      <div class="card-body">
        <h5 class="card-title mb-3">⚠️ Maintenance Alerts</h5>
        <div class="alert alert-warning">
          <strong>Truck AG8957UV</strong> - Fuel pressure dropped 15% (Clogged
          filter suspected)
        </div>
        <div class="alert alert-danger">
          <strong>Truck AG9822UV</strong> - Odometer 85,000km (Fuel filter
          service overdue)
        </div>
        <div class="card mt-4">
          <div class="card-body">
            <h5 class="card-title mb-3">Truck List</h5>
            <div class="table-responsive">
              <table
                class="table table-striped table-bordered"
                id="zero_config"
              >
                <thead>
                  <tr>
                    <th>License Plate</th>
                    <th>Brand</th>
                    <th>Model</th>
                    <th>Year</th>
                    {% comment %}
                    <th>Odometer (km)</th>
                    {% endcomment %} {% comment %}
                    <th>Last Service</th>
                    {% endcomment %}
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for truck in trucks %}
                  <tr>
                    <td>{{ truck.license_plate }}</td>
                    <td>{{ truck.brand }}</td>
                    <td>{{ truck.model }}</td>
                    <td>{{ truck.year }}</td>
                    {% comment %}
                    <td>{{ truck.odometer }}</td>
                    {% endcomment %} {% comment %}
                    <td>{{ truck.last_service_date|date:"Y-m-d" }}</td>
                    {% endcomment %}
                    <td>
                      {% if truck.status == 'active' %}
                      <span class="badge bg-success">Active</span>
                      {% elif truck.status == 'in_maintenance' %}
                      <span class="badge bg-warning">In Maintenance</span>
                      {% else %}
                      <span class="badge bg-danger">Inactive</span>
                      {% endif %}
                    </td>
                    <td>
                      <a
                        class="btn btn-primary btn-sm"
                        href="{% url 'dashboard-truck' %}?id={{ truck.id }}"
                        data-truck-id="{{ truck.id }}"
                      >
                        Detail
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-4">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Brand Statistic</h5>
        <canvas id="statisticBrand"></canvas>
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block js_block %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link
  rel="stylesheet"
  href="{% static 'assets/libs/datatables.net-bs5/css/dataTables.bootstrap5.min.css' %}"
/>
<script src="{% static 'assets/libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'assets/libs/datatables.net-bs5/js/dataTables.bootstrap5.min.js' %}"></script>
<script>
  $(document).ready(function () {
    $("#zero_config").DataTable();
    // Initialize tooltips
    $('[data-toggle="tooltip"]').tooltip();
    updateStatisticBrandChart();
  });
</script>
<script>
  var pieChart;
  function updateStatisticBrandChart() {
    $.ajax({
      url: "/maintenance/dinamis/statistic-brand-chart/",
      method: "GET",
      success: function (data) {
        if (pieChart) {
          pieChart.data.labels = data.labels;
          pieChart.data.datasets[0].data = data.values;
          pieChart.update();
        } else {
          var ctx = document.getElementById("statisticBrand").getContext("2d");
          pieChart = new Chart(ctx, {
            type: "pie",
            data: {
              labels: data.labels,
              datasets: [
                {
                  data: data.values,
                  backgroundColor: data.labels.map(
                    (_, i) =>
                      [
                        "#FF6384",
                        "#36A2EB",
                        "#FFCE56",
                        "#4BC0C0",
                        "#9966FF",
                        "#FF9F40",
                        "#1cc88a",
                        "#e74a3b",
                        "#f6c23e",
                        "#36b9cc",
                      ][i % 10]
                  ),
                },
              ],
            },
          });
        }
      },
    });
    // Initial load
  }
</script>
<script>
  // Fuel Efficiency by Brand
  const fuelCtx = document.getElementById("fuelChart").getContext("2d");
  new Chart(fuelCtx, {
    type: "bar",
    data: {
      labels: ["Hino", "Isuzu", "Mitsubishi", "UD Trucks"],
      datasets: [
        {
          label: "Avg km/L",
          data: [5.2, 5.8, 4.1, 5.5],
          backgroundColor: ["#4e73df", "#1cc88a", "#e74a3b", "#f6c23e"],
        },
      ],
    },
  });
</script>
{% endblock %}
